# Copyright (c) 2024, elias Alshaibani and contributors
# For license information, please see license.txt

# import frappe
#from frappe.model.document import Document

#class Sessionss(Document):
#	pass

import frappe
from hijri_converter import convert
from datetime import datetime
from frappe.model.document import Document

class Sessionss(Document):
    def validate(self):
        """
        ????? ??????? ???????? ??? ???? ?? ????? ????? ??? ??? ???????.
        """
        if self.gregorian_date:  # ?????? ?? ???? ??????? ????????
            try:
                self.hijri_date = convert_to_hijri_with_day(self.gregorian_date)
            except Exception as e:
                frappe.throw(f"??? ??? ????? ????? ??????? ???????? ??? ????: {str(e)}")

def convert_to_hijri_with_day(gregorian_date):
    try:
        # ????? ???? ??? ???? ????? ??????
        gregorian_date_obj = datetime.strptime(gregorian_date, "%Y-%m-%d")
        # ????? ??????? ???????? ??? ????
        hijri_date = convert.Gregorian(
            gregorian_date_obj.year,
            gregorian_date_obj.month,
            gregorian_date_obj.day
        ).to_hijri()
        # ??????? ????? datetime ?????? ??? ?????
        day_name = get_day_name(gregorian_date_obj)
        # ????? ??????? ?????? ?? ?????
        return f"{hijri_date.year}-{hijri_date.month:02d}-{hijri_date.day:02d} {day_name}"
    except ValueError:
        raise ValueError("????? ??????? ???????? ??? ????. ?????? ????? ??????? ????? YYYY-MM-DD.")
    except Exception as e:
        raise Exception(f"??? ??? ????? ????? ???????: {str(e)}")

def get_day_name(date_obj):
    # ??????? ????? datetime ?????? ??? ?????
    days = ["???????", "????????", "????????", "??????", "??????", "?????", "?????"]
    return days[date_obj.weekday()]
